# Internal role variables and values that must NOT be overridden by the user.
#
# Variables defined here usually override earlier definitions due to the high
# precedence of this file. Each variable should have a concise comment above
# it, describing its purpose and how it fits into the role's functionality.

---

# List of facts used by the role (gathered on a best-effort basis if needed).
#
# To identify which subset a fact belongs to during development, you can use
# the following snippet:
#
# - ansible.builtin.setup:
#     gather_subset:
#       - '!min'
#       - '<subset_name, see parameter doc for details>'
__run_fail2ban_used_facts:
  # from subset "distribution"
  - "distribution"
  - "distribution_major_version"
  - "distribution_version"
  - "os_family"


# List of platforms this role supports and was designed for.
#
# A warning will be issued if the list contains values and the role is executed
# on an unknown (not listed) platform, but execution will continue. Example:
#
# - name: "Fedora" # A ansible_facts value ('distribution' or 'os_family')
#   versions: # A ansible_facts value ('distribution_major_version' or
#     - "all" # 'distribution_version') or "all"
# - name: "Ubuntu"
#   versions:
#     - "22.04"
#     - "24.04"
# - name: "RedHat"
#   versions:
#     - "all"
# - name: "Debian"
#   versions:
#     - "all"
__run_fail2ban_supported_platforms:
  - name: "Debian"
    versions:
      - "12"
      - "13"
  - name: "Fedora"
    versions:
      - "43"
      - "42"
  - name: "openSUSE Leap"
    versions:
      - "16.0"
  - name: "RedHat" # includes AlmaLinux, Rocky and CentOS Stream
    versions:
      - "9"
      - "10"
  - name: "Ubuntu"
    versions:
      - "24.04"
      - "22.04"


# List of package names to be installed when run_fail2ban_state is
# set to "present".
__run_fail2ban_packages_install:
  - "fail2ban"


# List of package names to be uninstalled when run_fail2ban_state is
# set to "absent". This variable is useful when __run_fail2ban_packages_install
# contains packages that are required for the managed software to function but
# should not be removed during uninstallation, as doing so could break other
# software. This is usually the case if there are common dependencies like
# "curl" or "openssl" which typically should remain installed even after
# uninstalling the software managed by this role.
__run_fail2ban_packages_uninstall: "{{ __run_fail2ban_packages_install }}"


# List of package names to be removed unconditionally before installation
# (e.g., to prevent conflicts or resolve incompatibilities).
__run_fail2ban_packages_removal: []


# List of paths of files and directories to be removed unconditionally after
# installation. This is useful for removing default configuration resources
# that would otherwise create confusion or conflict with custom configurations
# managed by this role.
__run_fail2ban_paths_removal: []


# Configuration file paths, ownership, and permissions. These variables define
# the different locations of configuration files, include directories, and
# Ansible-managed files, ensuring consistent file handling across distributions.
__run_fail2ban_config_service_file_path: "/etc/fail2ban/fail2ban.conf"
__run_fail2ban_config_service_file_owner: "root"
__run_fail2ban_config_service_file_group: "root"
__run_fail2ban_config_service_file_mode: "u=rw,g=r,o=r" # 0644

__run_fail2ban_config_service_dropin_dir_path: "/etc/fail2ban/fail2ban.d"
__run_fail2ban_config_service_dropin_dir_owner: "{{ __run_fail2ban_config_service_file_owner }}"
__run_fail2ban_config_service_dropin_dir_group: "{{ __run_fail2ban_config_service_file_group }}"
__run_fail2ban_config_service_dropin_dir_mode: "u=rwx,g=rx,o=rx" # 0755

__run_fail2ban_config_service_dropin_file_path: "{{ __run_fail2ban_config_service_dropin_dir_path }}/{{ run_fail2ban_config_service_dropin_file_name }}"
__run_fail2ban_config_service_dropin_file_path_default: "{{ __run_fail2ban_config_service_dropin_dir_path }}/99-managed.local" # noqa: yaml[line-length] # needed to detect non-default names
__run_fail2ban_config_service_dropin_file_owner: "{{ __run_fail2ban_config_service_file_owner }}"
__run_fail2ban_config_service_dropin_file_group: "{{ __run_fail2ban_config_service_file_group }}"
__run_fail2ban_config_service_dropin_file_mode: "{{ __run_fail2ban_config_service_file_mode }}"

__run_fail2ban_config_jail_dropin_dir_path: "/etc/fail2ban/jail.d"
__run_fail2ban_config_jail_dropin_dir_owner: "{{ __run_fail2ban_config_service_file_owner }}"
__run_fail2ban_config_jail_dropin_dir_group: "{{ __run_fail2ban_config_service_file_group }}"
__run_fail2ban_config_jail_dropin_dir_mode: "{{ __run_fail2ban_config_service_dropin_dir_mode }}"

__run_fail2ban_config_jail_dropin_file_path: "{{ __run_fail2ban_config_jail_dropin_dir_path }}/{{ run_fail2ban_config_jail_dropin_file_name }}"
__run_fail2ban_config_jail_dropin_file_path_default: "{{ __run_fail2ban_config_jail_dropin_dir_path }}/99-managed.local" # needed to detect non-default names
__run_fail2ban_config_jail_dropin_file_owner: "{{ __run_fail2ban_config_service_file_owner }}"
__run_fail2ban_config_jail_dropin_file_group: "{{ __run_fail2ban_config_service_file_group }}"
__run_fail2ban_config_jail_dropin_file_mode: "{{ __run_fail2ban_config_service_file_mode }}"

__run_fail2ban_config_filter_dropin_dir_path: "/etc/fail2ban/filter.d"
__run_fail2ban_config_filter_dropin_dir_owner: "{{ __run_fail2ban_config_service_file_owner }}"
__run_fail2ban_config_filter_dropin_dir_group: "{{ __run_fail2ban_config_service_file_group }}"
__run_fail2ban_config_filter_dropin_dir_mode: "{{ __run_fail2ban_config_service_dropin_dir_mode }}"

__run_fail2ban_config_filter_dropin_file_owner: "root"
__run_fail2ban_config_filter_dropin_file_group: "root"
__run_fail2ban_config_filter_dropin_file_mode: "u=rw,g=r,o=r" # 0644

__run_fail2ban_config_action_dropin_dir_path: "/etc/fail2ban/action.d"
__run_fail2ban_config_action_dropin_dir_owner: "{{ __run_fail2ban_config_service_file_owner }}"
__run_fail2ban_config_action_dropin_dir_group: "{{ __run_fail2ban_config_service_file_group }}"
__run_fail2ban_config_action_dropin_dir_mode: "{{ __run_fail2ban_config_service_dropin_dir_mode }}"

__run_fail2ban_config_action_dropin_file_owner: "root"
__run_fail2ban_config_action_dropin_file_group: "root"
__run_fail2ban_config_action_dropin_file_mode: "u=rw,g=r,o=r" # 0644


# Daemon service name and paths of executables for management and validation.
__run_fail2ban_fail2ban_servicename: "fail2ban.service"
__run_fail2ban_server_exec_path: "/usr/bin/fail2ban-server"
__run_fail2ban_client_exec_path: "/usr/bin/fail2ban-client"
__run_fail2ban_regex_exec_path: "/usr/bin/fail2ban-regex"


# Paths of other executables and resources.
__run_fail2ban_sha1sum_exec_path: "/usr/bin/sha1sum"
__run_fail2ban_touch_exec_path: "/usr/bin/touch"
__run_fail2ban_chmod_exec_path: "/usr/bin/chmod"
__run_fail2ban_chown_exec_path: "/usr/bin/chown"


# Additional default configuration Fail2ban service configuration.
#
# See run_fail2ban_service_settings in defaults/main.yml for a detailled
# description of the structure (as this variable is using the same).
__run_fail2ban_service_settings_defaults: {}


# Platform-specific overrides for service settings. Overridden by platform
# vars files (e.g., vars/debian.yml). Gets merged on top of the defaults
# before user settings are applied.
__run_fail2ban_service_settings_overwrite: {}


# Internal default settings for jail configuration (jail.d drop-in). These
# provide sensible defaults for the critical platform-dependent knobs. Platform
# vars files override specific keys via __run_fail2ban_jail_settings_overwrite.
__run_fail2ban_jail_settings_defaults:
  DEFAULT:
    # Ignore LAN IP addresses and the host itself
    ignoreself: true
    ignoreip: "127.0.0.1/8 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 ::1/128 fc00::/7 fe80::/10"
    # Modern Linux uses systemd journal as primary log source. The "systemd"
    # backend lets fail2ban read directly from journald instead of relying on
    # log files.
    backend: "systemd"
    # Preventing encoding test (logencoding = "auto") safes some CPU cycles and
    # should be no problem with systemd logs / modern software (and: can still
    # be overwritten per-jail as needed)
    logencoding: "utf-8"
    # Modern Linux uses nftables as the native firewall engine (and iptables
    # often runs in nf_tables compatibility mode). "multiport" keeps bans
    # scoped to the jail's configured ports, which is a conservative default
    # that reduces collateral impact; jails that set port=all will automatically
    # use banaction_allports for a full host-level block.
    # Users / platforms that manage the firewall via a higher-level tool should
    # override these actions to not mix firewall rule ownership (e.g. if
    # firewalld (firewallcmd-*), ufw (ufw), or legacy iptables manages the
    # firewall.
    # Hint to list available actions: ls -l /etc/fail2ban/action.d/
    banaction: "nftables[type=multiport]" # "multiport" is usually default for nftables, but let's be explicit here
    banaction_allports: "nftables[type=allports]" # Note: Actions like "nftables-allports" are legacy syntax
  sshd:
    enabled: true
    port: "ssh"
    filter: "sshd"
    maxretry: 5


# Platform-specific overrides for jail settings. Overridden by platform vars
# files (e.g., vars/debian.yml, vars/redhat.yml). Gets merged on top of the
# defaults before managed jails and user settings are applied.
__run_fail2ban_jail_settings_overwrite: {}


# Mapping of log backend names to additional packages that need to be
# installed. Backends not listed here do not require extra packages.
# This is highly platform-specific specific, so the variable gets propably
# overwritten by platform vars files (e.g., vars/debian.yml, vars/redhat.yml).
# Please note that the "polling" backend (usually used as slow fallback) does
# not need any extra packages at all.
__run_fail2ban_packages_install_map_backends: {}


### Override defaults of dependencies used by this role (if any).

# nothing right now
